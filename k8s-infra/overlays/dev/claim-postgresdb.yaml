apiVersion: xgeeks.org/v1alpha1
kind: PGDatabase
metadata:
  name: demo-postgres-db-claim
  namespace: idp-dev
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
  # do not put finalizer here - will not sync ???
spec:
  # save secrets generated by this resource into...
  writeConnectionSecretToRef:
    name: demo-postgres-dev-db-claim-secret
  parameters:
    cloudResourceGroup: gabtec-rg # or team resGroup or OrgResGroup
    cloudLocation: North Europe
    # serverName will originate a dns flexibleserverName.postgres.database.azure.com
    # use <Name>-at-xgeeks-flexserver.postgres.database.azure.com
    serverName: demo-postgres-dev-at-xgeeks # only letters and number - crossplane will append "-psqlflexibleserver" --> name of DB Server on Azure
    # teamName: idp_training # for tags only
    dbWorkloadType: small
    storageInMb: 32768
    # dbVersion: 14 # 11 | 12 | 13 | 14 | 15
    dbVersion: 14 # 11 | 12 | 13 | 14 | 15 - not yet available crossplane
    # the Secret, created by ESO, that olds PG_PASSWORD
    dbSecretRefName: demo-postgres-dev-db-secret
    dbSecretRefKey: password # default because of use of eso random passwords
    destNamespace: idp-dev
    dbName: demo-postgres_db
    dbAdmin: psqladmin
    dbCharset: UTF8
    dbCollation: pt_PT.utf8
    # fw rule to allow traffic inside azure services (0-to-0)
    allowIpFrom: "0.0.0.0"
    allowIpTo: "0.0.0.0"
    tags:
      xgeeks.project.managed-by: crossplane
      xgeeks.project.team: idp_training
      xgeeks.project.name: idp
